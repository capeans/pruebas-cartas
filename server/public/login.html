<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Acceder</title>
</head>
<body style="max-width:400px;margin:40px auto;font-family:sans-serif;">
  <main class="auth-wrapper">
    <h1 id="auth-title">Iniciar sesión</h1>

    <div id="register-extra" style="display:none;">
      <label>Nombre completo</label>
      <input id="reg-name" type="text" style="width:100%;padding:8px;margin-bottom:12px;" />
    </div>

    <label>Email</label>
    <input id="auth-email" type="email" style="width:100%;padding:8px;margin-bottom:12px;" />

    <label>Contraseña</label>
    <input id="auth-pass" type="password" style="width:100%;padding:8px;margin-bottom:20px;" />

    <button id="auth-btn" style="width:100%;padding:10px 14px;background:#222;color:#fff;border-radius:6px;border:none;cursor:pointer;">
      Entrar
    </button>

    <p style="margin-top:20px;font-size:14px;text-align:center;">
      <span id="toggle-text">¿No tienes cuenta?</span>
      <button id="toggle-mode" style="background:none;border:none;color:#0070f3;cursor:pointer;padding:0;font-size:14px;">
        Regístrate
      </button>
    </p>

    <p style="margin-top:20px;font-size:14px;text-align:center;">
      <a href="index.html" style="color:#0070f3;text-decoration:none;">Volver a la tienda</a>
    </p>

    <p id="auth-error" style="color:#c00;font-size:14px;margin-top:10px;"></p>
  </main>

  <script src="js/api.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/cart.js"></script>
  <script>
    let mode = "login";

    const titleEl = document.getElementById("auth-title");
    const extraEl = document.getElementById("register-extra");
    const btnEl = document.getElementById("auth-btn");
    const toggleBtn = document.getElementById("toggle-mode");
    const toggleText = document.getElementById("toggle-text");
    const errorEl = document.getElementById("auth-error");

    toggleBtn.addEventListener("click", () => {
      mode = (mode === "login" ? "register" : "login");
      if (mode === "login") {
        titleEl.textContent = "Iniciar sesión";
        extraEl.style.display = "none";
        btnEl.textContent = "Entrar";
        toggleText.textContent = "¿No tienes cuenta?";
        toggleBtn.textContent = "Regístrate";
      } else {
        titleEl.textContent = "Crear cuenta";
        extraEl.style.display = "block";
        btnEl.textContent = "Registrarme";
        toggleText.textContent = "¿Ya tienes cuenta?";
        toggleBtn.textContent = "Inicia sesión";
      }
    });

    btnEl.addEventListener("click", async () => {
      errorEl.textContent = "";
      const email = document.getElementById("auth-email").value.trim();
      const pass = document.getElementById("auth-pass").value.trim();
      const name = document.getElementById("reg-name").value.trim();

      try {
        if (mode === "login") {
          await loginUser(email, pass);
        } else {
          await registerUser(email, pass, name);
        }
        await syncCartToServer();
        window.location.href = "carrito.html";
      } catch (err) {
        errorEl.textContent = err.message || "Error";
      }
    });
  </script>
</body>
</html>
