<!DOCTYPE html><html lang='es'><head><title>UzuTCG â€¢ Checkout</title><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><link rel='icon' href='assets/img/favicon.svg' type='image/svg+xml'><link rel='stylesheet' href='styles.css'><script defer src='bundle.js'></script></head><body><header class='header'><div class='container header-inner'><a class='brand' href='index.html'><img class='brand-logo' src='assets/img/logo.svg' alt='UzuTCG'><span class='brand-name'>UzuTCG</span></a><nav id='site-nav' class='nav'><a href='cartas.html'>Cartas</a><a href='cajas.html'>Cajas</a><a href='categoria.html?cat=Pok%C3%A9mon'>CategorÃ­as</a><a href='conecta.html'>Conecta</a></nav><a class='btn cart-icon' href='cart.html' aria-label='Carrito'>ðŸ›’<span id='cart-count' class='cart-count' style='display:none'>0</span></a></div></header>
<section class='section'><div class='container'>
<header class='section-head'><h2>Checkout</h2><p>Completa tus datos y confirma el pedido.</p></header>
<div class='grid' style='grid-template-columns:1.5fr 1fr;gap:14px'>
  <article class='card'><div class='wrap'><h3>Datos de envÃ­o</h3>
    <form id='checkout-form' class='form'>
      <div class='form-grid'>
        <label>Nombre completo<input name='name' required></label>
        <label>Email<input type='email' name='email' required></label>
        <label>TelÃ©fono<input name='phone'></label>
        <label>Ciudad<input name='city' required></label>
        <label class='full'>DirecciÃ³n<textarea name='address' rows='3' required></textarea></label>
      </div>
      <h3>MÃ©todo de pago</h3>
      <label><input type='radio' name='pay' value='card' checked> Tarjeta</label>
      <label><input type='radio' name='pay' value='paypal'> PayPal</label>
      <div class='actions'><button class='btn btn-primary' type='submit'>Pagar ahora</button></div>
      <p id='pay-status' class='meta'></p>
    </form>
  </div></article>
  <article class='card'><div class='wrap'><h3>Resumen</h3><div id='summary'></div></div></article>
</div>
</div></section>
<script>
(function(){
  const sum = document.getElementById('summary'); const items = UZU.cartLoad();
  if(!items.length){ sum.innerHTML = "<div class='empty'>Carrito vacÃ­o.</div>"; return; }
  let total=0;
  sum.innerHTML = items.map(x=>{ total += x.price*x.qty; return "<div style='display:flex;justify-content:space-between'><span>"+x.name+" Ã— "+x.qty+"</span><strong>"+(x.price*x.qty).toFixed(2)+" â‚¬</strong></div>";}).join('')
    + "<hr><div style='display:flex;justify-content:space-between'><span>Total</span><strong>"+total.toFixed(2)+" â‚¬</strong></div>";
  const form = document.getElementById('checkout-form'); const status = document.getElementById('pay-status');
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    status.textContent = "Procesando pago (demo)â€¦";
    setTimeout(()=>{
      status.textContent = "Pago completado (demo). Â¡Gracias!";
      localStorage.removeItem('uzu_cart_v1'); UZU.updateCartCount();
    }, 1000);
  });
})();
</script>
<footer class='footer'><div class='container footer-grid'><div><a class='brand' href='index.html'><img class='brand-logo' src='assets/img/logo.svg' alt='UzuTCG'><span class='brand-name'>UzuTCG</span></a><p>Â© <span id='year'></span> UzuTCG</p></div><nav><a href='#' onclick='alert("Aviso legal (demo)");return false;'>Aviso legal</a> Â· <a href='#' onclick='alert("Privacidad (demo)");return false;'>Privacidad</a></nav></div></footer><script>document.getElementById('year').textContent=new Date().getFullYear();</script>
<script src="js/api.js"></script>
<script src="js/auth.js"></script>
<script src="js/cart.js"></script>
<script>
  async function refreshCartCount() {
    try {
      const cart = await getCartDetail();
      const count = cart.reduce((sum, item) => sum + item.qty, 0);
      const counter = document.getElementById('cart-count');
      if (counter) counter.textContent = count;
    } catch (e) {
      console.warn(e);
    }
  }

  function hookAddToCartButtons(){
    document.querySelectorAll(".btn-add-cart").forEach(btn => {
      btn.addEventListener("click", async () => {
        const productId = parseInt(btn.dataset.productId, 10);
        if (!productId) {
          alert("Este producto no tiene ID interno todavÃ­a.");
          return;
        }
        addToLocalCart(productId, 1);
        await syncCartToServer();
        await refreshCartCount();
        btn.textContent = "AÃ±adido âœ“";
        setTimeout(() => { btn.textContent = "AÃ±adir al carrito"; }, 1200);
      });
    });
  }

  // inicializaciÃ³n al cargar la pÃ¡gina
  (async () => {
    hookAddToCartButtons();
    await refreshCartCount();
  })();
</script>

</body></html>